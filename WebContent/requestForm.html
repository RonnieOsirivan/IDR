<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Internet Document Request</title>
 <meta charset="UTF-8" />
        <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  -->
        <title>Internet Document Request</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <meta name="description" content="Internet Document Request" />
        <meta name="keywords" content="html5, css3, form, switch, animation, :target, pseudo-class" />
        <meta name="author" content="Codrops" />
        <link rel="stylesheet" type="text/css" href="css/demo.css" />
        <link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/animate-custom.css" />
		<link rel="stylesheet" type="text/css" href="css/sweetalert.css" />
		<script type="text/javascript" src="./js/phoneNumberFormat.js"></script>
		<script type="text/javascript" src="./bootstrap/jquery/dist/jquery.js"></script>
		<script type="text/javascript" src="./js/sweetalert-dev.js"></script>
</head>
<body>
 <div class="container">
            <div class="codrops-top">
                <div class="clr"></div>
            </div><!--/ Codrops top bar -->
            <header>
                <h1>Internet Document Request <span>RBRU</span></h1>
            </header>
            <section>				
                <div id="container_demo" >
                    <!-- hidden anchor to stop jump http://www.css3create.com/Astuce-Empecher-le-scroll-avec-l-utilisation-de-target#wrap4  -->
                    <a class="hiddenanchor" id="toregister"></a>
                    <a class="hiddenanchor" id="tologin"></a>
                    <div id="wrapper">
                        <div id="login" class="animate form">
                            <form  action="./LoginController" autocomplete="on" method="post"> 
                                <h1>Request Form</h1>
                                
                                <div id="userInfo"></div>
                                
                                <br>
                                <p>
                                	<select id="reportType">
                                		<option value="studentStatus" selected="selected">ใบรับรองการเป็นนักศึกษา</option>
                                		<option value="type2">type2</option>
                                	</select>
                                	<!--<input id="checkType" name="checkType" type="checkbox" value="1"/>แบบฟอร์มรับรองการเป็นนักศึกษา
                                	<input id="checkType" name="checkType" type="checkbox" value="2"/>request type2<br>  -->
                                </p> 
                                <p>
                                	<label>เลือกภาษา</label><br>
                                	<input id="checkTypeLangThai" name="checkTypeLang" type="checkbox" value="thai"/>ภาษาไทย
                                	<input id="checkTypeLangEng" name="checkTypeLang" type="checkbox" value="english" onchange="onCheckBoxChange(this)"/>ภาษาอังกฤษ
                                </p>
                                
                                <div id="inputName" style="display:none">
                                	<p>
	                                	<label for="firstName" class="uname"> First name </label>
	                                	<input id="firstName" name="firstName" type="text" placeholder="Enter your first name">
                                	</p>
                                	<p>
                                		<label for="lastName" class="uname"> Last name </label>
                                		<input id="surName" name="lastName" type="text" placeholder="Enter your last name">
                                	</p>
                                </div>
                                
                                <p> 
                                    <label for="telephone" class="uname" >เบอร์โทรศัพท์</label>
                                    <input id="telephoneNumber" name="telephoneNumber" type="text" onkeydown="backspacerDOWN(this,event);" onkeyup="backspacerUP(this,event);" placeholder="Your Telephone Number"/>
                                </p>
                                <p>
                                	<label for="reason" class="uname" >นำไปใช้เพื่อ</label>
                                	<input id="reason" name="reason" type="text" placeholder="Use for">
                                </p>
                                <p class="login button"> 
                                    <input type="button" value="request" onclick="valthisform();"/> 
								</p>
                                <p class="change_link">
									<a href="#toregister" class="to_register">Log out</a>
								</p>
                            </form>
                        </div>
                    </div>
                </div>  
            </section>
        </div>
        
        <script type="text/javascript">
        
        //get user information
        var xmlhttp = loadXMLDoc();
        var json;
        var reportTypeParam ="";
        var langParam="";
        var nameParam="";
        var telephoneParam="";
        
        xmlhttp.onreadystatechange=function(){
			if (xmlhttp.readyState==4 && xmlhttp.status==200){
				json = JSON.parse(xmlhttp.responseText);
				document.getElementById("userInfo").innerHTML= json[0].prefix+json[0].firstName+" "+json[0].lastName+" รหัส "+json[0].studentCode+" คณะ "+json[0].facultyName;
			}
        }
        xmlhttp.open("GET","./RequestController",true);
        xmlhttp.send();
	        
        
        function valthisform(){
            var checkType=document.getElementsByName("checkType");
            var requestFlag1=true;
            var requestFlag2=false;
            var requestFlag3=false;
            var requestFlag4=false;
            
            var e =  document.getElementById("reportType");
            reportTypeParam="&reportTypeParam="+e.options[e.selectedIndex].value;
            
            /* for(var i=0,l=checkType.length;i<l;i++){
                if(checkType[i].checked){
                	requestFlag1=true;
                	reportTypeParam += checkType[i].value+",";
                }
            }
            reportTypeParam = reportTypeParam.substring(0, reportTypeParam.length-1);*/
            console.log(reportTypeParam); 
            
            if(!requestFlag1){
            	swal("Please select report type", "", "error");
            }else if(requestFlag1){
            	var checkTypeLang = document.getElementsByName("checkTypeLang");
            	langParam = "&lang=";
            	for(var i=0,l=checkTypeLang.length;i<l;i++){
                    if(checkTypeLang[i].checked){
                    	requestFlag2=true;
                    	langParam += checkTypeLang[i].value+",";
                    }
                }
            	langParam = langParam.substring(0, langParam.length-1);
            	console.log(langParam)
            	if(!requestFlag2){
            		swal("Please select language", "", "error");
            	}
            }
            
            if(document.getElementById("checkTypeLangEng").checked && requestFlag2){
            	if(((document.getElementById("firstName").value).trim()).length < 1){
            		swal("Please input your firstname", "", "error");
            	}else if(((document.getElementById("surName").value).trim()).length < 1){
            		swal("Please input your surname", "", "error");
            	}else{
            		nameParam = "&firstName="+(document.getElementById("firstName").value).trim()+"&surName="+(document.getElementById("surName").value).trim();
            		requestFlag3 = true;
            	}
            }else if(requestFlag2){
            	requestFlag3 = true;
            }
            
            if(requestFlag3){
            	var telephoneValue = document.getElementById("telephoneNumber").value;
            	if((telephoneValue.trim()).length < 1){
            		swal("Please input telepone number", "", "error");
            	}else{
            		telephoneParam = "&telephoneParam="+telephoneValue;
            		requestFlag4 = true;
            	}
            }
            
            if(requestFlag1 && requestFlag2 && requestFlag3 && requestFlag4){
            	sendRequestGenerateReport(json);
            }
        }//valthisform()
        
        function sendRequestGenerateReport(json){
        	var xmlhttp = loadXMLDoc();
            
            xmlhttp.onreadystatechange=function(){
    			if (xmlhttp.readyState==4 && xmlhttp.status==200){
    				swal({type:"success",
    					title: "Success", 
    					confirmButtonText: "ok"
    					},
    					function(){
    						window.location.assign("./management.html");
    					});
    			}
            }
            xmlhttp.open("GET","./GenerateReportController?studentCode="+json[0].studentCode+reportTypeParam+langParam+nameParam+telephoneParam+"&useforParam="+document.getElementById("reason").value,true);
            xmlhttp.send();
        }
        
        function loadXMLDoc(){
	        var xmlhttp;
	        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
				xmlhttp=new XMLHttpRequest();
	        }
	        else{// code for IE6, IE5
	          	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	        }
	        return xmlhttp;
		}
        
        function onCheckBoxChange(e){
        	if(e.checked){
        		document.getElementById('inputName').style.display='block';
        		if(json[0].firstNameEng){
        			document.getElementById('firstName').value = json[0].firstNameEng;
        		}else{
        			document.getElementById('firstName').value = "";
        		}
        		
        		if(json[0].surNameEng){
        			document.getElementById('surName').value = json[0].surNameEng;
        		}else{
        			document.getElementById('surName').value = "";
        		}
        	}else{
        		document.getElementById('inputName').style.display='none';
        	}
        }
        
        $(function(){
		    $("#firstName").keypress(function(event){
		    	checkInputEnglistOnly(event.which);
		    });
		    $("#surName").keypress(function(event){
		    	checkInputEnglistOnly(event.which);
		    });
		});
        
        function checkInputEnglistOnly(ew){
        	if((65 <= ew && ew <= 90) || (97 <= ew && ew <= 122)){
	        	return true;
	        }else{
	        	swal("Enter English character only","","error");
	        	return false;
	        }
        }
        </script>
</body>
</html>